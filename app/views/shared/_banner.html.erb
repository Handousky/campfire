<% @stories.each do |story| %>
  <div class="banner-drop">
    <div id="side-banner">
      <div class="banner-title">
        <h2><%= story.title %></h2>
      </div>

      <div class="banner-category">
        <% story.categories.each do |category| %>
          <%= category.name %> <%= '-' unless category == story.categories.last %>
        <% end %>
      </div>

      <div class="rating">
        <p>Your Rating:
          <div id="user_star_<%= story.id %>">
            <%
              @rating = Rating.find_by(story: story, user: @current_user)
              unless @rating
                @rating = Rating.create(story: story, user: @current_user, score: 0)
              end
            %>
          </div>
        </p>
      </div>

      <div class="banner-description">
        <p><%= story.description %></p>
      </div>
        <%= link_to "Read the story", story_slides_path(story), class: "banner-read btn btn-danger" %>
    </div>
    <div class="banner-img" style="background-image: linear-gradient(90deg,rgba(0,0,0,1), rgba(0,0,0,0) 30%), url('<%= cl_image_path story.photo.path if story.photo? %>')">
    </div>
  </div>
<% end %>

<% content_for(:afterjs) do %>
  <script>
    <% @stories.each do |story| %>
      $('#user_star_<%= story.id %>').raty({
          score: <%= @rating.score %>,
          path: '/assets',
          click: function(score, evt) {
            $.ajax({
              url: '/ratings/' + <%= @rating.id %>,
              type: 'PATCH',
              data: { score: score }
            }).done(function (data){});
          }
        });
    <% end %>
  </script>
<% end %>
