<% if @slide.photo? %>
<div id="fullscreen" class="slide-wrapper" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.2)), url('<%= cl_image_path @slide.photo.path %>')">
<% else %>
<div id="fullscreen" class="slide-wrapper">
<% end %>

  <div class="navbar navbar-wagon navbar-slides-view">
    <div class="control">
    <% if user_signed_in? && @slide.story.user == current_user %>
      <%= link_to "Edit", edit_story_slide_path(@story, @slide), id: 'btn-edit', class: "btn btn-primary btn-ctrl" %>
    <% end %>
    <%= link_to "Panic", stories_path, class: "btn btn-warning btn-ctrl" %>
    <%= link_to "Fullscreen", '#', class: "btn btn-success btn-ctrl", id: 'btn-fs' %>
    </div>
  </div>

  <div class="container slides-container">
    <div id="narration">
      <%= @slide.narration.html_safe unless @slide.narration.nil? %>
    </div>


    <div class="arrow-hidden up-arrow">
      <%= link_to (@slide.get_up.nil? ? '#' : story_slide_path(@story, @slide.get_up)), remote: true, id: "up" do %>
        <%= image_tag "arrow-up.png" %>
      <% end %>
    </div>

    <div class="arrow-hidden down-arrow">
      <%= link_to (@slide.get_down.nil? ? '#' : story_slide_path(@story, @slide.get_down)), remote: true, id: "down" do %>
        <%= image_tag "arrow-down.png" %>
      <% end %>
    </div>

    <div class="arrow-hidden left-arrow">
      <%= link_to (@slide.get_left.nil? ? '#' : story_slide_path(@story, @slide.get_left)), remote: true, id: "left" do %>
        <%= image_tag "arrow-left.png" %>
      <% end %>
    </div>

    <div class="arrow-hidden right-arrow">
      <%= link_to (@slide.get_right.nil? ? '#' : story_slide_path(@story, @slide.get_right)), remote: true, id: "right" do %>
        <%= image_tag "arrow-right.png" %>
      <% end %>
    </div>

  </div>
</div>

<% content_for(:afterjs) do %>
  <script>
    // Fullscreen function
    if (
      document.fullscreenEnabled || document.webkitFullscreenEnabled ||
      document.mozFullScreenEnabled || document.msFullscreenEnabled
    ) {
      document.getElementById("btn-fs").addEventListener("click", function(event) {
        var i = document.getElementById("fullscreen");
        // go full-screen
        if (i.requestFullscreen) {

          i.requestFullscreen();
        } else if (i.webkitRequestFullscreen) {
          i.webkitRequestFullscreen();
        } else if (i.mozRequestFullScreen) {
          i.mozRequestFullScreen();
        } else if (i.msRequestFullscreen) {
          i.msRequestFullscreen();
        }
      });
    } else {
      document.getElementById("btn-fs").style.display = "none";
    }


    //AJAX moving
    <% if @slide.get_up %>
      $('.up-arrow').css("display", "flex");
    <% end %>

    <% if @slide.get_down %>
      $('.down-arrow').css("display", "flex");
    <% end %>

    <% if @slide.get_left %>
      $('.left-arrow').css("display", "flex");
    <% end %>

    <% if @slide.get_right %>
      $('.right-arrow').css("display", "flex");
    <% end %>

    // moving with arrows
    document.addEventListener("keyup", function(event) {
      event.preventDefault();
      if (event.keyCode === 37) {
        document.getElementById("left").click();
      } else if (event.keyCode === 38) {
        document.getElementById("up").click();
      } else if (event.keyCode === 39) {
        document.getElementById("right").click();
      } else if (event.keyCode === 40) {
        document.getElementById("down").click();
      }
    });
  </script>
<% end %>
